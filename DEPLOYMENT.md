# Deployment Guide - MLab Cookie Policy Module

## Recommended Approach: Pre-compile Before Deployment

The **recommended approach** is to compile TypeScript before deploying to PrestaShop. This ensures:
- Faster installation
- No dependency on Node.js in production
- Consistent behavior across environments

### Pre-Deployment Steps

1. **Compile TypeScript locally:**
   ```bash
   cd modules/mlab_cookie_policy
   npm install
   npx tsc
   ```

2. **Verify compiled files exist:**
   ```bash
   ls -lh assets/js/cookie-policy.js
   ```
   The file should be ~5KB and contain the compiled JavaScript.

3. **Commit the compiled JS file:**
   ```bash
   git add assets/js/cookie-policy.js
   git commit -m "Add compiled JavaScript for deployment"
   ```

4. **Deploy to PrestaShop:**
   - ZIP the module folder
   - Upload via PrestaShop admin panel or FTP
   - Install the module

### Files to Include in Deployment

**Required:**
- ✅ `assets/js/cookie-policy.js` (compiled JavaScript)
- ✅ `views/templates/hook/cookie_banner.tpl`
- ✅ `mlab_cookie_policy.php`
- ✅ All PHP files in `src/` directory

**Optional (for development):**
- `assets/ts/cookie-policy.ts` (TypeScript source)
- `tsconfig.json`
- `package.json`

**Excluded (.gitignore):**
- ❌ `node_modules/`
- ❌ `vendor/` (will be generated by Composer)
- ❌ `*.d.ts`, `*.d.ts.map`, `*.js.map` (TypeScript artifacts)

## Alternative: Auto-Compile During Installation

The module can attempt to compile TypeScript during installation if:
- Node.js and npx are installed on the server
- The compiled JS file is missing

**This approach:**
- ✅ Works if Node.js is available
- ❌ Slower installation
- ❌ May fail on restricted hosting
- ❌ Not recommended for production

## Quick Deployment Checklist

- [ ] Run `npx tsc` to compile TypeScript
- [ ] Verify `assets/js/cookie-policy.js` exists and has content
- [ ] Test locally in PrestaShop
- [ ] Create ZIP of module folder
- [ ] Upload to production PrestaShop
- [ ] Install module via admin panel

## Troubleshooting

### Error: "Cookie policy JavaScript file is missing"

**Solution:** Compile TypeScript before installation:
```bash
cd modules/mlab_cookie_policy
npx tsc
```

### TypeScript compilation errors

**Solution:** Check your TypeScript syntax:
```bash
npx tsc --noEmit  # Check for errors without compiling
```

### Module not working after installation

**Solution:** Check browser console for JavaScript errors and verify:
1. JS file is loaded: View page source, search for `cookie-policy.js`
2. Banner elements exist: Inspect page, look for `#mlab-cookie-banner`
3. Console for errors: Open browser DevTools → Console tab

## Development Workflow

For active development:

1. **Watch mode for auto-compilation:**
   ```bash
   npx tsc --watch
   ```

2. **Make changes to TypeScript:**
   Edit `assets/ts/cookie-policy.ts`

3. **Test in browser:**
   Refresh PrestaShop page to see changes

4. **Before committing:**
   ```bash
   npx tsc  # Final compile
   git add assets/ts/cookie-policy.ts assets/js/cookie-policy.js
   git commit -m "Update cookie policy functionality"
   ```

## Production Optimization

For production environments, consider:

1. **Minification:** Use a minifier to reduce JS file size
   ```bash
   npx terser assets/js/cookie-policy.js -o assets/js/cookie-policy.min.js -c -m
   ```

2. **Update PHP to use minified version** (in production):
   ```php
   $this->context->controller->addJS($this->_path . 'assets/js/cookie-policy.min.js');
   ```

3. **Enable browser caching** in `.htaccess`:
   ```apache
   <FilesMatch "\.(js|css)$">
       Header set Cache-Control "max-age=2592000, public"
   </FilesMatch>
   ```
